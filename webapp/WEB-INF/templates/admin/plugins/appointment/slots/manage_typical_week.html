<#include "/admin/plugins/appointment/appointmentform/modify_appointmentform_tabs.html" />
<script src="js/plugins/appointment/moment.min.js" ></script>
<link rel='stylesheet' href='css/plugins/appointment/fullcalendar.css' />
<script src='js/plugins/appointment/jquery.min.js' ></script>
<script src='js/plugins/appointment/fullcalendar.min.js' ></script>
<script src='js/plugins/appointment/locale-all.js' ></script>
<script src="js/plugins/appointment/bootstrap-datepicker.js" ></script>
<link rel='stylesheet' href='css/plugins/appointment/bootstrap-datepicker.min.css' />
<link rel="stylesheet" href="js/jquery/plugins/ui/css/jquery-ui.min.css"  />
<link rel='stylesheet' href='css/plugins/appointment/bootstrap-datepicker.standalone.css' />

<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
    	<@tabs tab="typicalWeek" appointmentform=appointmentform />
		<div class="tab-content">
		<fieldset>			
			<form id="listOfDates" class="form-horizontal" method="post" action="jsp/admin/plugins/appointment/ManageAppointmentSlots.jsp?view=manageTypicalWeek&id_form=${appointmentform.idForm}">
				<#if listDateOfModification??>					
					<div class="form-group">
							<label class="col-xs-12 col-sm-3 control-label" for="id_week_definition">#i18n{appointment.modifyAppointmentForm.listDateOfModification}:</label>
							<div class="col-xs-12 col-sm-9">							
								<select id="id_week_definition" name="id_week_definition" class="form-control" onchange="refresh()">
									<#list listDateOfModification as item>
										<#if "${id_week_definition}"="${item.code}">
											<option selected="selected" value="${item.code}" >${item.name}</option>
										<#else>
											<option value="${item.code}" >${item.name}</option>
										</#if>
									</#list>	
								</select>
							</div>
						</div>					
				</#if>					
			</form>			
			<hr color="black">
			<div id="calendar"></div>	
		</fieldset>				
	</div>
</div>
<script type="text/javascript">	
	function refresh() {
		document.getElementById("listOfDates").submit();
	}
	var slotDuration = '${min_duration}';
    var minTime = '${min_time}';
    var maxTime = '${max_time}';
    var dow = [
		<#if dow??>								   
			<#list dow as day>
				'${day}',								
			</#list>
		</#if>				
	];    
    var eventUrl = 'jsp/admin/plugins/appointment/ManageAppointmentSlots.jsp?view=viewModifyTimeSlot&id_form=${appointmentform.idForm}&id_week_definition=${id_week_definition}&id_time_slot=';
    var columnFormat = 'dddd';
    var events = [
		<#if events??>								   
			<#list events as event>
				{
					title : <#if event.isOpen>'#i18n{appointment.labelOpen}'<#else>'#i18n{appointment.manageCalendarSlots.labelClosed}'</#if> 
									+ ' / ' + 'Capacit\u00e9 max : ' + '${event.maxCapacity}',									
					start : '${event.startingDateTime}',
					end : '${event.endingDateTime}',
					id : '${event.idTimeSlot}',
					color : <#if event.isOpen>'default'<#else>'red'</#if>,
				},								
			</#list>
		</#if>
	];
    $(document).ready(function() {
		$('#calendar').fullCalendar({		
			defaultView: 'agendaWeek',
			height: 'auto',
			locale: 'fr',			
			theme: true,                  
			editable: false,        
			header: false,
			columnFormat: columnFormat,
			slotLabelFormat: 'H:mm',
			slotLabelInterval: slotDuration,
			slotDuration: slotDuration,
			allDaySlot: false,
			minTime: minTime,
			maxTime: maxTime,        
			businessHours: {
				start: minTime,
				end: maxTime,
				dow: dow
			},
			eventClick: function(calEvent, jsEvent, view) {
				location.href = eventUrl + calEvent.id;
			},
			events: events,
			eventAfterAllRender: function(view) {								
				$('.fc-event').css('cursor', 'pointer');
			},
		});        
    });      
</script>